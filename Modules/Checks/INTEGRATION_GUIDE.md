# ุฏููู ุงูุชูุงูู ุงููุญุงุณุจู - ูุธุงู ุฅุฏุงุฑุฉ ุงูุดููุงุช

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุฅุฏุงุฑุฉ ุงูุดููุงุช ููุชูุงูู ุจุดูู ูุงูู ูุน ุงููุธุงู ุงููุญุงุณุจู ูููุดุฑูุนุ ุญูุซ ูููู ุจุฅูุดุงุก ุงููููุฏ ุงููุญุงุณุจูุฉ ุชููุงุฆูุงู ุนูุฏ ูู ุนูููุฉ.

---

## ๐๏ธ ุงููููู ุงููุญุงุณุจู

### 1. ุฃููุงุน ุงูุนูููุงุช (pro_types)

ุชู ุฅุถุงูุฉ 8 ุนูููุงุช ุฌุฏูุฏุฉ ูุฅุฏุงุฑุฉ ุงูุดููุงุช:

| ID | ุงูุงุณู ุงูุจุฑูุฌู | ุงููุตู ุงูุนุฑุจู | ุงูููุน |
|---|---|---|---|
| **65** | `incoming_check` | ูุฑูุฉ ูุจุถ | ุดูู |
| **66** | `outgoing_check` | ูุฑูุฉ ุฏูุน | ุดูู |
| **67** | `check_collection` | ุชุญุตูู ุดูู | ุดูู |
| **68** | `check_endorsement` | ุชุธููุฑ ุดูู | ุดูู |
| **69** | `bounced_check` | ุดูู ูุฑุชุฏ | ุดูู |
| **70** | `cancel_check` | ุฅูุบุงุก ุดูู | ุดูู |
| **71** | `check_reversal` | ููุฏ ุนูุณู ูุดูู | ุดูู |
| **72** | `check_transfer` | ุชุญููู ุดูู ููุจูู | ุดูู |

### 2. ุงูุญุณุงุจุงุช ุงููุญุงุณุจูุฉ (acc_head)

#### ุญุงูุธุงุช ุงูุฃูุฑุงู ุงููุงููุฉ:

| ID | ุงูููุฏ | ุงูุงุณู | ุงูููุน | Parent |
|---|---|---|---|---|
| **63** | 110501 | ุญุงูุธุฉ ุฃูุฑุงู ุงููุจุถ | check-portfolios | ุฃูุฑุงู ุงููุจุถ (27) |
| **66** | 210301 | ุญุงูุธุฉ ุฃูุฑุงู ุงูุฏูุน | check-portfolios | ุฃูุฑุงู ุงูุฏูุน (43) |

---

## ๐ ุงููููุฏ ุงููุญุงุณุจูุฉ

### ูุฑูุฉ ูุจุถ (Incoming Check)
ุนูุฏ ุงุณุชูุงู ุดูู ูู ุนููู:

```
ูู ุญ/ ุญุงูุธุฉ ุฃูุฑุงู ุงููุจุถ (110501)     XXX
    ุฅูู ุญ/ ุงูุนููู (1103XX)                    XXX
```

**ูุซุงู:**
- ุงุณุชูุงู ุดูู ุจูููุฉ 5,000 ุฑ.ุณ ูู ุงูุนููู ูุญูุฏ ุฃุญูุฏ

```
ูู ุญ/ ุญุงูุธุฉ ุฃูุฑุงู ุงููุจุถ     5,000
    ุฅูู ุญ/ ูุญูุฏ ุฃุญูุฏ              5,000
```

### ูุฑูุฉ ุฏูุน (Outgoing Check)
ุนูุฏ ุฅุตุฏุงุฑ ุดูู ูููุฑุฏ:

```
ูู ุญ/ ุงูููุฑุฏ (2101XX)                 XXX
    ุฅูู ุญ/ ุญุงูุธุฉ ุฃูุฑุงู ุงูุฏูุน (210301)     XXX
```

**ูุซุงู:**
- ุฅุตุฏุงุฑ ุดูู ุจูููุฉ 3,000 ุฑ.ุณ ููููุฑุฏ ุดุฑูุฉ ุงูููุฑ

```
ูู ุญ/ ุดุฑูุฉ ุงูููุฑ             3,000
    ุฅูู ุญ/ ุญุงูุธุฉ ุฃูุฑุงู ุงูุฏูุน     3,000
```

### ุชุญุตูู ุดูู (Check Collection)
ุนูุฏ ุชุญููู ุงูุดูู ููุจูู ูุชุญุตููู:

```
ูู ุญ/ ุงูุจูู (1102XX)                XXX
    ุฅูู ุญ/ ุญุงูุธุฉ ุฃูุฑุงู ุงููุจุถ (110501)    XXX
```

### ุดูู ูุฑุชุฏ (Bounced Check)
ุนูุฏ ุงุฑุชุฏุงุฏ ุงูุดูู:

```
ูู ุญ/ ุงูุนููู (1103XX)                  XXX
    ุฅูู ุญ/ ุญุงูุธุฉ ุฃูุฑุงู ุงููุจุถ (110501)     XXX
```

---

## ๐พ ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 1. ุฌุฏูู checks

```sql
- id
- check_number (ุฑูู ุงูุดูู - ูุฑูุฏ)
- bank_name (ุงุณู ุงูุจูู)
- account_number (ุฑูู ุงูุญุณุงุจ)
- account_holder_name (ุตุงุญุจ ุงูุญุณุงุจ)
- amount (ุงููุจูุบ)
- issue_date (ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ)
- due_date (ุชุงุฑูุฎ ุงูุงุณุชุญูุงู)
- payment_date (ุชุงุฑูุฎ ุงูุฏูุน)
- status (pending|cleared|bounced|cancelled)
- type (incoming|outgoing)
- payee_name (ุงููุณุชููุฏ)
- payer_name (ุงูุฏุงูุน)
- notes (ููุงุญุธุงุช)
- reference_number (ุฑูู ุงููุฑุฌุน)
- attachments (ุงููุฑููุงุช - JSON)
- created_by (ุงูููุดุฆ)
- approved_by (ุงููุนุชูุฏ)
- approved_at (ุชุงุฑูุฎ ุงูุงุนุชูุงุฏ)
- oper_id (ุฑูู ุงูุนูููุฉ ูู operhead) โญ ุฌุฏูุฏ
```

### 2. ุฑุจุท ูุน operhead

ูู ุดูู ูุชู ุฅูุดุงุคู ูููุดุฆ ุณุฌู ูู ุฌุฏูู `operhead`:

```sql
- pro_id (ุฑูู ุงูุนูููุฉ ุงูุชุณูุณูู)
- pro_type (ููุน ุงูุนูููุฉ: 65 ุฃู 66)
- pro_num (ุฑูู ุงูุดูู)
- pro_date (ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ)
- acc1 (ุญุงูุธุฉ ุงูุฃูุฑุงู ุงููุงููุฉ)
- acc2 (ุงูุนููู ุฃู ุงูููุฑุฏ)
- pro_value (ูููุฉ ุงูุดูู)
- fat_net (ุตุงูู ุงููุจูุบ)
- info (ูุนูููุงุช ุงูุดูู)
- details (ุชูุงุตูู JSON)
- is_finance = 1
- is_journal = 1
```

### 3. ุฑุจุท ูุน journal_head ู journal_details

ูุชู ุฅูุดุงุก ููุฏ ูุญุงุณุจู ุชููุงุฆูุงู:

**journal_head:**
```sql
- journal_id (ุฑูู ุงูููุฏ)
- total (ุฅุฌูุงูู ุงููุจูุบ)
- date (ุชุงุฑูุฎ ุงูููุฏ)
- op_id (ุฑูู ุงูุนูููุฉ ูู operhead)
- pro_type (ููุน ุงูุนูููุฉ)
- details (ุชูุงุตูู)
```

**journal_details:**
```sql
- journal_id (ุฑูู ุงูููุฏ)
- account_id (ุฑูู ุงูุญุณุงุจ)
- debit (ูุฏูู)
- credit (ุฏุงุฆู)
- type (0=ูุฏูู, 1=ุฏุงุฆู)
- info (ุงูุจูุงู)
- op_id (ุฑูู ุงูุนูููุฉ)
```

---

## ๐ ุณูุฑ ุงูุนูู (Workflow)

### 1. ุฅุถุงูุฉ ุดูู ุฌุฏูุฏ

```
ุงููุณุชุฎุฏู โ Controller โ Validation
    โ
Transaction Begin
    โ
1. Create OperHead Record
    โ
2. Get new pro_id
    โ
3. Create Journal Entry (createJournalEntry)
    โ
4. Create Check Record
    โ
Transaction Commit โ Success
```

### 2. ุงูุญูุธ ูู Controller

```php
ChecksController::store(Request $request)
{
    DB::beginTransaction();
    
    // 1. ุฅูุดุงุก operhead
    $oper = OperHead::create([...]);
    
    // 2. ุฅูุดุงุก ุงูููุฏ ุงููุญุงุณุจู
    $this->createJournalEntry($oper, $validated, $portfolioAccount);
    
    // 3. ุฅูุดุงุก ุงูุดูู
    $check = Check::create([...]);
    
    DB::commit();
}
```

### 3. ุฅูุดุงุก ุงูููุฏ ุงููุญุงุณุจู

```php
private function createJournalEntry($oper, $data, $portfolioAccount)
{
    // 1. ุฅูุดุงุก journal_head
    $journalHead = JournalHead::create([...]);
    
    // 2. ุฅูุดุงุก journal_details (ุณุทุฑูู)
    if ($data['type'] === 'incoming') {
        // ูุฏูู: ุญุงูุธุฉ ุฃูุฑุงู ุงููุจุถ
        JournalDetail::create([
            'debit' => $amount,
            'credit' => 0,
        ]);
        
        // ุฏุงุฆู: ุงูุนููู
        JournalDetail::create([
            'debit' => 0,
            'credit' => $amount,
        ]);
    }
}
```

---

## ๐ฏ ุญุงูุงุช ุงูุงุณุชุฎุฏุงู

### ูุซุงู 1: ุงุณุชูุงู ุดูู ูู ุนููู

```
ุงููุฏุฎูุงุช:
- ุฑูู ุงูุดูู: 123456
- ุงูุจูู: ุงูุจูู ุงูุฃููู
- ุงููุจูุบ: 10,000 ุฑ.ุณ
- ุงูุนููู: ูุญูุฏ ุฃุญูุฏ (ID: 61)
- ุงูููุน: incoming

ุงููุชูุฌุฉ:
1. ุฅูุดุงุก ุณุฌู ูู checks
2. ุฅูุดุงุก ุณุฌู ูู operhead (pro_type = 65)
3. ุฅูุดุงุก ููุฏ ูู journal_head ู journal_details:
   - ูู ุญ/ ุญุงูุธุฉ ุฃูุฑุงู ุงููุจุถ (63): 10,000 ูุฏูู
   - ุฅูู ุญ/ ูุญูุฏ ุฃุญูุฏ (61): 10,000 ุฏุงุฆู
```

### ูุซุงู 2: ุฅุตุฏุงุฑ ุดูู ูููุฑุฏ

```
ุงููุฏุฎูุงุช:
- ุฑูู ุงูุดูู: 789012
- ุงูุจูู: ุจูู ุงูุฑูุงุถ
- ุงููุจูุบ: 7,500 ุฑ.ุณ
- ุงูููุฑุฏ: ุดุฑูุฉ ุงูุชูุฑูุฏ (ID: 64)
- ุงูููุน: outgoing

ุงููุชูุฌุฉ:
1. ุฅูุดุงุก ุณุฌู ูู checks
2. ุฅูุดุงุก ุณุฌู ูู operhead (pro_type = 66)
3. ุฅูุดุงุก ููุฏ ูู journal_head ู journal_details:
   - ูู ุญ/ ุดุฑูุฉ ุงูุชูุฑูุฏ (64): 7,500 ูุฏูู
   - ุฅูู ุญ/ ุญุงูุธุฉ ุฃูุฑุงู ุงูุฏูุน (66): 7,500 ุฏุงุฆู
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุญุณุงุจ ุงููุฑุชุจุท ุงุฎุชูุงุฑู**: ูููู ุฅุถุงูุฉ ุดูู ุจุฏูู ุฑุจุทู ุจุญุณุงุจ ุนููู/ููุฑุฏ
2. **ุงููููุฏ ุงูุชููุงุฆูุฉ**: ูุชู ุฅูุดุงุก ุงูููุฏ ุงููุญุงุณุจู ุชููุงุฆูุงู ุนูุฏ ุงูุญูุธ
3. **ุงูุชูุงูู ุงููุงูู**: ุงููุธุงู ูุชูุงูู ูุน operhead ู journal_head ู journal_details
4. **ุงูุฃูุงู**: ุงุณุชุฎุฏุงู Transactions ูุถูุงู ุชูููุฐ ูู ุงูุนูููุงุช ุฃู ุงูุชุฑุงุฌุน ุงููุงูู
5. **ุงูุชุชุจุน**: ูู ุดูู ูุฑุชุจุท ุจู oper_id ููุฑุฌูุน ููุนูููุฉ ุงูุฃุตููุฉ

---

## ๐ง ุงูุชุทููุฑ ุงููุณุชูุจูู

### ุงูุนูููุงุช ุงููุงุฏูุฉ:

1. **ุชุญุตูู ุดูู (67)**: ุชุญููู ุงูุดูู ููุจูู
2. **ุชุธููุฑ ุดูู (68)**: ููู ุงูุดูู ูุทุฑู ุขุฎุฑ
3. **ุดูู ูุฑุชุฏ (69)**: ูุนุงูุฌุฉ ุงูุดููุงุช ุงููุฑุชุฏุฉ
4. **ุฅูุบุงุก ุดูู (70)**: ุฅูุบุงุก ุงูุดูู
5. **ููุฏ ุนูุณู (71)**: ุฅูุดุงุก ููุฏ ุนูุณู
6. **ุชุญููู ููุจูู (72)**: ุชุญููู ุงูุดูู ููุจูู

---

## ๐ ุงูุฏุนู

ููุงุณุชูุณุงุฑุงุช ุฃู ุงููุณุงุนุฏุฉุ ูุฑุฌู ุงูุชูุงุตู ูุน ูุฑูู ุงูุชุทููุฑ.

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ**: ุฃูุชูุจุฑ 2025
**ุงูุฅุตุฏุงุฑ**: 1.0
